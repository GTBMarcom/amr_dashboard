<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AGV ROI 시뮬레이션 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body.dark {
      background-color: #080b12;
      color: #ffffff;
    }
    .model-image {
      height: 96px;
      object-fit: contain;
    }
  </style>
</head>
<body class="transition-colors">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r dark:bg-[#121212] dark:border-gray-700 p-4 overflow-y-auto">
      <h2 class="text-xl font-bold mb-4">모델 선택</h2>
      <select id="modelSelector" class="w-full p-2 border rounded mb-4 text-[#080b12]">
        <option value="M6-300N">M6-300N</option>
        <option value="Z50-SF">Z50-SF</option>
        <option value="YAF10">YAF10</option>
        <!-- 필요시 더 추가 -->
      </select>
      <div id="modelList" class="space-y-4">
        <!-- 모델 카드 동적 삽입 -->
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 bg-[#f7f8fa] dark:bg-[#0c0f16]">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">ROI 시뮬레이션</h1>
        <button id="toggleTheme" class="px-4 py-2 border rounded">🌗 테마 전환</button>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white dark:bg-[#1c1f26] p-6 rounded shadow">
          <h2 class="text-lg font-semibold mb-4">손익분기점 분석 (24개월)</h2>
          <canvas id="breakevenChart" height="250"></canvas>
        </div>

        <div class="bg-white dark:bg-[#1c1f26] p-6 rounded shadow">
          <h2 class="text-lg font-semibold mb-4">월별 투자 대비 절감 효과</h2>
          <canvas id="monthlyChart" height="250"></canvas>
        </div>
      </div>

      <div class="mt-6 flex justify-end">
        <button id="downloadPDF" class="px-6 py-2 bg-[#080b12] text-white rounded shadow hover:bg-[#1a1f2c]">PDF 저장하기</button>
      </div>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const modelData = {
      "M6-300N": {
        image: "http://gtbkorea.com/board/download/424b70200f0fdedb814795970d94d737",
        cost: 15000000,
        monthlySavings: 900000,
      },
      "Z50-SF": {
        image: "http://gtbkorea.com/board/download/2340dd9e5e0ae97f88b4c2e90dcb2cf8",
        cost: 18000000,
        monthlySavings: 1200000,
      },
      "YAF10": {
        image: "http://gtbkorea.com/board/download/724be54bff8b685721fad714c04e8f50",
        cost: 16000000,
        monthlySavings: 1000000,
      },
    };

    const modelSelector = document.getElementById("modelSelector");
    const modelList = document.getElementById("modelList");
    const ctx1 = document.getElementById("breakevenChart").getContext("2d");
    const ctx2 = document.getElementById("monthlyChart").getContext("2d");

    let breakevenChart, monthlyChart;

    function renderModelCard(model) {
      const data = modelData[model];
      modelList.innerHTML = `
        <div class="flex gap-4 items-center bg-gray-100 dark:bg-[#2a2f3a] p-4 rounded">
          <img src="${data.image}" class="model-image w-32" alt="${model}" />
          <div>
            <h3 class="text-xl font-bold">${model}</h3>
            <p>도입 비용: ${data.cost.toLocaleString()}원</p>
            <p>월 절감액: ${data.monthlySavings.toLocaleString()}원</p>
          </div>
        </div>
      `;
    }

    function renderCharts(model) {
      const data = modelData[model];
      const labels = Array.from({ length: 24 }, (_, i) => `${i + 1}월`);
      const cumulativeSavings = labels.map((_, i) => data.monthlySavings * (i + 1));
      const investment = Array(24).fill(data.cost);
      const breakevenIndex = cumulativeSavings.findIndex(v => v >= data.cost);

      if (breakevenChart) breakevenChart.destroy();
      breakevenChart = new Chart(ctx1, {
        type: "line",
        data: {
          labels,
          datasets: [
            {
              label: "누적 절감액",
              data: cumulativeSavings,
              borderColor: "#22c55e",
              backgroundColor: "#22c55e33",
              fill: false,
            },
            {
              label: "도입 비용",
              data: investment,
              borderColor: "#ef4444",
              backgroundColor: "#ef444433",
              fill: false,
            }
          ]
        },
        options: {
          plugins: {
            tooltip: {
              callbacks: {
                label: ctx => `₩ ${ctx.raw.toLocaleString()}`
              }
            },
            annotation: {
              annotations: breakevenIndex >= 0 ? {
                line: {
                  type: 'line',
                  scaleID: 'x',
                  value: labels[breakevenIndex],
                  borderColor: '#0ea5e9',
                  borderWidth: 2,
                  label: {
                    content: '손익분기점',
                    enabled: true,
                    position: 'end'
                  }
                }
              } : {}
            }
          },
          scales: {
            y: {
              ticks: {
                callback: v => `₩${v.toLocaleString()}`
              }
            }
          }
        }
      });

      if (monthlyChart) monthlyChart.destroy();
      monthlyChart = new Chart(ctx2, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "월별 절감액",
            data: Array(24).fill(data.monthlySavings),
            backgroundColor: "#3b82f6"
          }]
        },
        options: {
          plugins: {
            tooltip: {
              callbacks: {
                label: ctx => `₩ ${ctx.raw.toLocaleString()}`
              }
            }
          },
          scales: {
            y: {
              ticks: {
                callback: v => `₩${v.toLocaleString()}`
              }
            }
          }
        }
      });
    }

    modelSelector.addEventListener("change", e => {
      const selectedModel = e.target.value;
      renderModelCard(selectedModel);
      renderCharts(selectedModel);
    });

    // PDF 저장
    document.getElementById("downloadPDF").addEventListener("click", async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("AGV ROI 시뮬레이션 보고서", 20, 20);
      doc.text(`모델: ${modelSelector.value}`, 20, 30);
      doc.save("roi_result.pdf");
    });

    // 다크모드 전환
    document.getElementById("toggleTheme").addEventListener("click", () => {
      document.body.classList.toggle("dark");
    });

    // 초기 실행
    renderModelCard(modelSelector.value);
    renderCharts(modelSelector.value);
  </script>
</body>
</html>
