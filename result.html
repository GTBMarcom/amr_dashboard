<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ROI 대시보드 결과</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #080b12;
      color: white;
      font-family: 'Segoe UI', sans-serif;
    }
    .card {
      background-color: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .highlight {
      background-color: #ff6f61;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .label {
      color: #79c9c7;
    }
  </style>
</head>
<body class="p-4 md:p-8">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-4xl font-bold mb-4 text-center">📊 AGV/AMR ROI 대시보드</h1>
    <p class="text-center mb-8 text-gray-300">AGV 수와 기간을 조절하여 손익분기점을 시뮬레이션 해보세요</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div class="card p-4 rounded">
        <label class="block mb-2">AGV 수 (1~10대)</label>
        <input id="agv-count" type="number" min="1" max="10" value="3" class="w-full px-4 py-2 rounded text-black" onchange="updateCharts()">
      </div>
      <div class="card p-4 rounded">
        <label class="block mb-2">통화 단위</label>
        <select id="currency" class="w-full px-4 py-2 rounded text-black" onchange="updateCharts()">
          <option value="원">KRW (원)</option>
          <option value="$">USD ($)</option>
        </select>
      </div>
    </div>

    <div class="card p-6 rounded mb-6">
      <h2 class="text-xl font-semibold mb-4">누적 절감액 (24개월)</h2>
      <canvas id="savingsChart" height="120"></canvas>
    </div>

    <div class="card p-6 rounded mb-6">
      <h2 class="text-xl font-semibold mb-4">월별 운영비용 비교</h2>
      <canvas id="compareChart" height="120"></canvas>
      <p id="breakeven-label" class="mt-4 text-center text-sm text-gray-400"></p>
    </div>

    <div class="text-center mt-6">
      <button onclick="downloadPDF()" class="bg-[#79c9c7] text-[#080b12] px-6 py-3 rounded shadow hover:bg-[#63b2b0] transition">
        PDF로 저장하기
      </button>
    </div>
  </div>

  <script>
    const months = Array.from({ length: 24 }, (_, i) => `${i + 1}월`);
    let savingsChart, compareChart;

    function generateData(agvCount = 3) {
      const savings = months.map((_, i) => (i + 1) * 250 * agvCount);
      const withAGV = months.map((_, i) => 1000 - i * 10 * agvCount);
      const withoutAGV = months.map(() => 1000);
      return { savings, withAGV, withoutAGV };
    }

    function getCurrencySymbol() {
      return document.getElementById('currency').value;
    }

    function findBreakeven(withAGV, withoutAGV) {
      for (let i = 0; i < withAGV.length; i++) {
        if (withAGV[i] <= withoutAGV[i]) return i;
      }
      return -1;
    }

    function createCharts() {
      const agvCount = parseInt(document.getElementById('agv-count').value);
      const currency = getCurrencySymbol();
      const { savings, withAGV, withoutAGV } = generateData(agvCount);
      const breakevenIndex = findBreakeven(withAGV, withoutAGV);

      if (savingsChart) savingsChart.destroy();
      if (compareChart) compareChart.destroy();

      savingsChart = new Chart(document.getElementById('savingsChart'), {
        type: 'line',
        data: {
          labels: months,
          datasets: [{
            label: '누적 절감액',
            data: savings,
            borderColor: '#79c9c7',
            backgroundColor: 'transparent',
            tension: 0.3
          }]
        },
        options: {
          plugins: {
            tooltip: {
              callbacks: {
                label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue}${currency}`
              }
            },
            legend: { labels: { color: 'white' } }
          },
          scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
          }
        }
      });

      compareChart = new Chart(document.getElementById('compareChart'), {
        type: 'line',
        data: {
          labels: months,
          datasets: [
            {
              label: 'AGV 도입',
              data: withAGV,
              borderColor: '#79c9c7',
              tension: 0.3,
              fill: false
            },
            {
              label: '기존 방식',
              data: withoutAGV,
              borderColor: '#ffd700',
              borderDash: [5, 5],
              tension: 0.3,
              fill: false
            }
          ]
        },
        options: {
          plugins: {
            tooltip: {
              callbacks: {
                label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue}${currency}`
              }
            },
            legend: { labels: { color: 'white' } }
          },
          scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
          }
        }
      });

      const label = document.getElementById('breakeven-label');
      label.innerHTML = breakevenIndex >= 0
        ? `💡 손익분기점은 <span class="highlight">${breakevenIndex + 1}월</span>입니다.`
        : '❗ 손익분기점이 24개월 내에 도달하지 않습니다.';
    }

    function updateCharts() {
      createCharts();
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.html(document.body, {
        callback: function (pdf) {
          pdf.save('ROI-dashboard.pdf');
        },
        x: 10,
        y: 10
      });
    }

    window.onload = () => createCharts();
  </script>
</body>
</html>
