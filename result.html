<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROI ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    body.dark {
      background-color: #080b12;
      color: #ffffff;
    }
    .dark .bg-white {
      background-color: #1f2937;
    }
    .dark .text-[#080b12] {
      color: #ffffff;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-[#080b12] relative">

  <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ -->
  <button id="darkModeToggle" class="fixed top-4 right-4 bg-white border border-[#080b12] text-[#080b12] px-3 py-1 rounded-md text-sm hover:bg-[#080b12] hover:text-white transition">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>

  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 text-center">AGV/AMR ROI ê²°ê³¼ ëŒ€ì‹œë³´ë“œ</h1>

    <!-- ROI ì°¨íŠ¸ -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">ì†ìµë¶„ê¸°ì  ë¶„ì„ (24ê°œì›”)</h2>
      <canvas id="roiChart" height="200"></canvas>
    </div>

    <!-- ì ˆê°ë¥  -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">ì›”ë³„ ì ˆê°ë¥  (24ê°œì›”)</h2>
      <canvas id="savingChart" height="200"></canvas>
    </div>

    <!-- PDF ì €ì¥ ë²„íŠ¼ -->
    <div class="text-center mt-6">
      <button id="savePdfBtn" class="bg-[#080b12] text-white px-6 py-3 rounded-md hover:bg-white hover:text-[#080b12] border border-[#080b12] transition">PDF ì €ì¥í•˜ê¸°</button>
    </div>
  </div>

  <script>
    // ë‹¤í¬ëª¨ë“œ í† ê¸€
    document.getElementById('darkModeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark');
    });

    // ìƒ˜í”Œ ê³„ì‚°ê°’ (ì˜ˆì‹œ)
    const monthlyLaborCost = 1800000; // ê¸°ì¡´ ì¸ê±´ë¹„ ì›”ë³„ (ë‹¨ìœ„: ì›)
    const agvCost = 25000000; // AGV ë„ì… ë¹„ìš© (1ëŒ€)
    const monthlySavings = 800000; // ì›” ì ˆê°ì•¡

    // 24ê°œì›” ëˆ„ì  ê³„ì‚°
    const months = Array.from({length: 24}, (_, i) => `${i+1}ê°œì›”`);
    let cumulativeHuman = [], cumulativeAgv = [], savingRate = [], breakevenMonth = null;

    for (let i = 0; i < 24; i++) {
      cumulativeHuman.push(monthlyLaborCost * (i+1));
      cumulativeAgv.push(agvCost);
      savingRate.push(Math.min(100, ((monthlyLaborCost * (i+1) - agvCost) / agvCost) * 100));
      if (!breakevenMonth && cumulativeHuman[i] >= agvCost) breakevenMonth = i;
    }

    const roiCtx = document.getElementById('roiChart');
    new Chart(roiCtx, {
      type: 'line',
      data: {
        labels: months,
        datasets: [
          {
            label: 'ëˆ„ì  ì¸ê±´ë¹„',
            data: cumulativeHuman,
            borderColor: '#2563eb',
            backgroundColor: 'transparent'
          },
          {
            label: 'AGV ë„ì… ë¹„ìš©',
            data: cumulativeAgv,
            borderColor: '#f43f5e',
            borderDash: [5, 5],
            backgroundColor: 'transparent'
          }
        ]
      },
      options: {
        plugins: {
          annotation: {
            annotations: breakevenMonth !== null ? {
              line1: {
                type: 'line',
                xMin: breakevenMonth,
                xMax: breakevenMonth,
                borderColor: 'green',
                borderWidth: 2,
                label: {
                  content: 'ì†ìµë¶„ê¸°ì ',
                  enabled: true,
                  position: 'start'
                }
              }
            } : {}
          },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.dataset.label}: ${ctx.raw.toLocaleString()}ì›`
            }
          }
        },
        responsive: true,
        maintainAspectRatio: false
      }
    });

    new Chart(document.getElementById('savingChart'), {
      type: 'bar',
      data: {
        labels: months,
        datasets: [{
          label: 'ëˆ„ì  ì ˆê°ë¥ (%)',
          data: savingRate,
          backgroundColor: '#16a34a'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.dataset.label}: ${ctx.raw.toFixed(1)}%`
            }
          }
        }
      }
    });

    // PDF ì €ì¥ ê¸°ëŠ¥
    document.getElementById('savePdfBtn').addEventListener('click', async () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const chartArea = document.body; // ì „ì²´ ì˜ì—­ PDF ì €ì¥
      const canvas = await html2canvas(chartArea);
      const imgData = canvas.toDataURL('image/png');
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
      pdf.save('roi_dashboard.pdf');
    });
  </script>
</body>
</html>
