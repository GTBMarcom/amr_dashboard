<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGV/AMR ROI 시뮬레이션 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>

<body class="bg-[#f7f8fa] text-[#080b12]">
  <div class="flex h-screen">
    <!-- 좌측 메뉴 -->
    <aside class="w-80 bg-white border-r border-gray-200 p-4 overflow-y-auto scrollbar-hide">
      <h2 class="text-xl font-bold mb-4">카테고리 선택</h2>
      <select id="categorySelect" class="w-full mb-4 border rounded px-3 py-2">
        <option value="저상형">저상형</option>
        <option value="분류형">분류형</option>
        <option value="운반형">운반형</option>
        <option value="지게형">지게형</option>
      </select>
      <div id="modelList" class="space-y-4"></div>
    </aside>

    <!-- 우측 콘텐츠 -->
    <main class="flex-1 p-6 overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">ROI 분석 대시보드</h1>
        <button id="downloadPdf" class="bg-[#080b12] text-white px-4 py-2 rounded">PDF 저장하기</button>
      </div>

      <!-- 사용자 입력폼 -->
      <div class="grid grid-cols-2 gap-4 mb-8">
        <div><label>1교대당 직원수</label><input type="number" id="employees" class="w-full border rounded px-3 py-2" value="3"></div>
        <div><label>시간당 비용 (원)</label><input type="number" id="hourlyCost" class="w-full border rounded px-3 py-2" value="15000"></div>
        <div><label>1교대 시간</label><input type="number" id="shiftHours" class="w-full border rounded px-3 py-2" value="8"></div>
        <div><label>1일당 교대</label><input type="number" id="shiftsPerDay" class="w-full border rounded px-3 py-2" value="2"></div>
        <div><label>주간 운영일수</label><input type="number" id="daysPerWeek" class="w-full border rounded px-3 py-2" value="5"></div>
        <div><label>연간 생산주간</label><input type="number" id="weeksPerYear" class="w-full border rounded px-3 py-2" value="50"></div>
      </div>

      <!-- 그래프 1: 혼합형 ROI 차트 -->
      <div class="bg-white p-4 rounded mb-8">
        <h2 class="text-xl font-bold mb-2">ROI 손익분기점</h2>
        <canvas id="roiChart" width="1600" height="800"></canvas>
      </div>

      <!-- 그래프 2: 월별 절감 추이 -->
      <div class="bg-white p-4 rounded mb-8">
        <h2 class="text-xl font-bold mb-2">월별 절감액 추이</h2>
        <canvas id="savingsChart" width="1600" height="800"></canvas>
      </div>
    </main>
  </div>

  <script>
    const models = [
      { name: "M6-300N", category: "저상형", image: "http://gtbkorea.com/board/download/424b70200f0fdedb814795970d94d737", cost: 30000000 },
      { name: "M6-600", category: "저상형", image: "http://gtbkorea.com/board/download/f707273357c45ecf554f773fcc29b27d", cost: 40000000 },
      { name: "T6-1200/1500", category: "저상형", image: "http://gtbkorea.com/board/download/e6e56ad00518e93b696b0cd0a1293904", cost: 60000000 },
      { name: "Z50-SF", category: "분류형", image: "http://gtbkorea.com/board/download/2340dd9e5e0ae97f88b4c2e90dcb2cf8", cost: 35000000 },
      { name: "ZS-H150", category: "운반형", image: "http://gtbkorea.com/board/download/080f97a986659ce4bc5f1cd0a12d09eb", cost: 42000000 },
      { name: "YAA10", category: "지게형", image: "http://gtbkorea.com/board/download/125d1ba1e7c70688aa4d162e7f5d7020", cost: 45000000 },
    ];

    const categorySelect = document.getElementById("categorySelect");
    const modelList = document.getElementById("modelList");
    const charts = {};

    function updateModelList() {
      const selectedCategory = categorySelect.value;
      modelList.innerHTML = "";
      const filtered = models.filter(m => m.category === selectedCategory);
      filtered.forEach(model => {
        const div = document.createElement("div");
        div.className = "flex gap-4 p-2 border rounded cursor-pointer hover:bg-gray-50";
        div.innerHTML = `
          <img src="${model.image}" alt="${model.name}" class="w-24 h-16 object-contain">
          <div>
            <h4 class="font-bold">${model.name}</h4>
            <p class="text-sm">도입비용: ${model.cost.toLocaleString()}원</p>
          </div>
        `;
        div.onclick = () => calculateROI(model);
        modelList.appendChild(div);
      });
    }

    function calculateROI(model) {
      const employees = +document.getElementById("employees").value;
      const hourlyCost = +document.getElementById("hourlyCost").value;
      const shiftHours = +document.getElementById("shiftHours").value;
      const shiftsPerDay = +document.getElementById("shiftsPerDay").value;
      const daysPerWeek = +document.getElementById("daysPerWeek").value;
      const weeksPerYear = +document.getElementById("weeksPerYear").value;

      const monthlyLaborCost = employees * hourlyCost * shiftHours * shiftsPerDay * daysPerWeek * 4;
      const cost = model.cost;

      const labels = Array.from({ length: 24 }, (_, i) => `${i + 1}개월`);
      const cumulativeSavings = labels.map((_, i) => monthlyLaborCost * (i + 1));
      const investment = labels.map(() => cost);

      const breakevenIndex = cumulativeSavings.findIndex(v => v >= cost);
      const breakevenMonth = breakevenIndex >= 0 ? breakevenIndex : null;

      if (charts.roiChart) charts.roiChart.destroy();
      charts.roiChart = new Chart(document.getElementById("roiChart"), {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: '누적 절감액', data: cumulativeSavings, borderColor: '#22c55e', tension: 0.4 },
            { label: '도입비용', data: investment, borderColor: '#ef4444', tension: 0.4 }
          ]
        },
        options: {
          responsive: false,
          animation: { duration: 1500, easing: 'easeOutQuart' },
          plugins: {
            annotation: {
              annotations: breakevenMonth !== null ? {
                line1: {
                  type: 'line',
                  xMin: breakevenMonth,
                  xMax: breakevenMonth,
                  borderColor: 'blue',
                  borderWidth: 2,
                  label: {
                    content: `ROI 도달 (${breakevenMonth + 1}개월)`,
                    enabled: true,
                    position: 'top'
                  }
                }
              } : {}
            }
          },
          scales: {
            y: { ticks: { stepSize: 5000000, callback: v => (v / 10000) + '만원' } }
          }
        }
      });

      if (charts.savingsChart) charts.savingsChart.destroy();
      charts.savingsChart = new Chart(document.getElementById("savingsChart"), {
        type: 'bar',
        data: {
          labels,
          datasets: [{ label: '월별 절감액', data: Array(24).fill(monthlyLaborCost), backgroundColor: '#60a5fa' }]
        },
        options: {
          responsive: false,
          animation: { duration: 1500, easing: 'easeInOutCubic' },
          scales: {
            y: { ticks: { stepSize: 5000000, callback: v => (v / 10000) + '만원' } }
          }
        }
      });
    }

    document.getElementById("downloadPdf").addEventListener("click", () => {
      html2pdf().from(document.body).set({ margin: 0.2, filename: 'roi-dashboard.pdf', html2canvas: { scale: 2 } }).save();
    });

    categorySelect.addEventListener("change", updateModelList);
    updateModelList();
  </script>
</body>
</html>
